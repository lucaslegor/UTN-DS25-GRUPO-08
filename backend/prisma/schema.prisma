generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Usuario {
  id           Int           @id @default(autoincrement())
  username     String        @unique
  passwordHash String
  rol          RolUsuario    @default(USUARIO)
  createdAt    DateTime      @default(now())
  mail         String        @unique
  adminProfile AdminProfile?
  solicitudes  Solicitud[]
}

model AdminProfile {
  idAdmin   Int      @id @default(autoincrement())
  idUsuario Int      @unique
  nombre    String
  email     String   @unique
  telefono  String?
  activo    Boolean
  createdAt DateTime @default(now())
  usuario   Usuario  @relation(fields: [idUsuario], references: [id])
}

model Producto {
  id             Int             @id @default(autoincrement())
  titulo         String
  descripcion    String
  cobertura      String
  tipo           TipoSeguro
  isActive       Boolean
  createdAt      DateTime        @default(now())
  imagenUrl      String?
  itemsSolicitud SolicitudItem[]
}

model Poliza {
  id          Int          @id @default(autoincrement())
  idSolicitud Int          @unique
  archivoUrl  String
  estado      EstadoPoliza @default(PENDIENTE)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  solicitud   Solicitud    @relation(fields: [idSolicitud], references: [id])
}

model SolicitudItem {
  idProducto  Int
  idSolicitud Int
  titulo      String
  cantidad    Int
  producto    Producto  @relation(fields: [idProducto], references: [id])
  solicitud   Solicitud @relation(fields: [idSolicitud], references: [id])

  @@id([idSolicitud, idProducto])
}

model Solicitud {
  id              Int             @id @default(autoincrement())
  idUsuario       Int
  estado          EstadoSolicitud @default(CREADA)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  datosPersonales Json?
  notaRechazo     String?
  poliza          Poliza?
  usuario         Usuario         @relation(fields: [idUsuario], references: [id])
  items           SolicitudItem[]
}

enum RolUsuario {
  ADMINISTRADOR
  USUARIO
}

enum TipoSeguro {
  AUTO
  HOGAR
  VIDA
  SALUD
}

enum EstadoPoliza {
  PENDIENTE
  CARGADA
}

enum EstadoSolicitud {
  CREADA
  PENDIENTE_POLIZA
  POLIZA_CARGADA
  APROBADA
  RECHAZADA
  CANCELADA
}
